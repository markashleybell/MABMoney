@model MABMoney.Web.Models.Home.IndexViewModel
@using MABMoney.Web.Models.Home

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/Master.cshtml";
}

<h2>@Model.Account.Name</h2>

@using (Html.BeginForm("", "Home", FormMethod.Post, new { @class = "form-inline" }))
{
    @Html.DropDownListFor(x => x.Account_AccountID, Model.Accounts) <input type="submit" class="btn" value="Go" />
}

<p>Starting Balance: @Model.Account.StartingBalance.ToString("#0.00"), Current Balance: @Model.Account.CurrentBalance.ToString("#0.00")</p>

<div class="row" id="test">
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
</div>

<ul class="nav nav-tabs lge">
  <li @Html.Raw((Model.Type == TransactionType.Income) ? "class=\"active\"" : "")><a href="#income" data-toggle="tab">Income: @Model.Transactions.Where(t => t.Amount > 0).Sum(x => x.Amount)</a></li>
  <li @Html.Raw((Model.Type == TransactionType.Expense) ? "class=\"active\"" : "")><a href="#expenses" data-toggle="tab">Expenses: @Model.Transactions.Where(t => t.Amount < 0).Sum(x => Math.Abs(x.Amount))</a></li>
</ul>
<div class="tab-content">
    <div class="tab-pane active" id="income">
        @using (Html.BeginForm("CreateTransaction", "Home"))
        {
            <div class="controls controls-row">
                @Html.EditorFor(x => x.Date, new { @class = "span2", placeholder = "Date" })
                @Html.DropDownListFor(x => x.Category_CategoryID, Model.Categories, "Category...", new { @class = "span2" })
                @Html.TextBoxFor(x => x.Description, new { @class = "span4", placeholder = "Description (optional)" })
                @Html.TextBoxFor(x => x.Amount, new { @class = "span2", placeholder = "Amount" })              
                <div class="span2">
                    <input type="submit" value="Add Income" class="btn btn-primary" />
                </div>
                @Html.HiddenFor(x => x.Account_AccountID)
                <input data-val="true" data-val-required="The Type field is required." id="Type" name="Type" type="hidden" value="Income">
            </div>
        }
        <table class="table table-striped">
            <caption>Transaction List</caption>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Description</th>
                    <th>Amount</th>
                    <th>Edit</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var transaction in Model.Transactions.Where(t => t.Amount > 0).OrderByDescending(x => x.Date).ThenByDescending(x => x.TransactionID))
                {
                <tr>
                    <td>@transaction.Date.ToString("dd/MM/yyyy")</td>
                    <td>@transaction.Description</td>
                    <td>@transaction.Amount.ToString("#0.00")</td>
                    <td>@Html.ActionLink("Edit", "Edit", new { id = transaction.TransactionID })</td>
                </tr>
                }
            </tbody>
        </table>
    </div>
    <div class="tab-pane" id="expenses">
        @using (Html.BeginForm("CreateTransaction", "Home"))
        {
            <div class="controls controls-row">
                @Html.EditorFor(x => x.Date, new { @class = "span2", placeholder = "Date" })
                @Html.DropDownListFor(x => x.Category_CategoryID, Model.Categories, "Category", new { @class = "span2" })
                @Html.TextBoxFor(x => x.Description, new { @class = "span4", placeholder = "Description (optional)" })
                @Html.TextBoxFor(x => x.Amount, new { @class = "span2", placeholder = "Amount" })              
                <div class="span2">
                    <input type="submit" value="Add Expense" class="btn btn-primary" />
                </div>
                @Html.HiddenFor(x => x.Account_AccountID)
                <input data-val="true" data-val-required="The Type field is required." id="Type" name="Type" type="hidden" value="Expense">
            </div>
        }
        <table class="table table-striped">
            <caption>Transaction List</caption>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Description</th>
                    <th>Amount</th>
                    <th>Edit</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var transaction in Model.Transactions.Where(t => t.Amount < 0).OrderByDescending(x => x.Date).ThenByDescending(x => x.TransactionID))
                {
                <tr>
                    <td>@transaction.Date.ToString("dd/MM/yyyy")</td>
                    <td>@transaction.Description</td>
                    <td>@transaction.Amount.ToString("#0.00")</td>
                    <td>@Html.ActionLink("Edit", "Edit", new { id = transaction.TransactionID })</td>
                </tr>
                }
            </tbody>
        </table>
    </div>    
 </div>

 <div class="row" id="test">
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
    <div class="span1">&nbsp;</div>
</div>
